#!/bin/sh

sudo pacman -Sy &
    notify-send -t 2000 --hint int:transient:1 "Updating database..." ||
    exit 1

wait

notify-send -t 5 "Database updated."

packagelist="$(pacman -Sup | sed 's/.*\///')"
n_packages="$(echo "$packagelist" | wc -l)"

[ -z $packagelist ] && notify-send "The system is up-to-date." && exit 0

option="$(echo -e "List\nUpdate" | dmenu -i -p "$n_packages packages are waiting for updates: ")"

case $option in
    "List")
            echo "$packagelist" | dmenu -i -l 10 -p "Packages waiting for update: " > /dev/null
        ;;
    "Update")
            [ "$(echo -e "No\nYes" | dmenu -i -p "Are you sure you want to update?: ")" == "Yes" ] &&
                sudo pacman -Syu --noconfirm &&
                notify-send "$n_packages package updated. The system is up-to-date."
        ;;
    "*")
        exit 0
        ;;
esac

